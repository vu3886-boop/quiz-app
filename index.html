<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quiz App</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 700px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h1, h2 {
      text-align: center;
    }
    input, button, textarea {
      font-family: Arial, sans-serif;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px 0;
    }
    button:hover {
      background: #0056b3;
    }
    .hidden {
      display: none;
    }
    .question {
      margin-bottom: 15px;
    }
    .result {
      font-weight: bold;
      text-align: center;
      margin-top: 20px;
      color: green;
    }
    .score-list {
      background: #fafafa;
      border-radius: 5px;
      padding: 10px;
      margin-top: 15px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>H·ªá th·ªëng tr·∫Øc nghi·ªám</h1>

    <!-- ƒêƒÉng nh·∫≠p -->
    <div id="loginScreen">
      <h2>ƒêƒÉng nh·∫≠p</h2>
      <input type="text" id="username" placeholder="T√™n ƒëƒÉng nh·∫≠p" /><br />
      <input type="password" id="password" placeholder="M·∫≠t kh·∫©u" /><br />
      <button onclick="login()">ƒêƒÉng nh·∫≠p</button>
      <p><small>T√†i kho·∫£n admin: <b>admin / 1234</b></small></p>
      <p><small>T√†i kho·∫£n kh√°ch: <b>guest1 / 1234</b>, <b>guest2 / 1234</b>...</small></p>
    </div>

    <!-- L√†m b√†i -->
    <div id="quizScreen" class="hidden">
      <h2>B√†i tr·∫Øc nghi·ªám</h2>
      <div id="questionList"></div>
      <button id="submitBtn" onclick="submitQuiz()">N·ªôp b√†i</button>
      <div class="result" id="result"></div>
    </div>

    <!-- Qu·∫£n tr·ªã -->
    <div id="adminPanel" class="hidden">
      <h2>Qu·∫£n l√Ω c√¢u h·ªèi</h2>
      <div id="adminQuestions"></div>

      <h3>Th√™m c√¢u h·ªèi m·ªõi</h3>
      <textarea id="newQuestionText" placeholder="Nh·∫≠p c√¢u h·ªèi..."></textarea><br />
      <input id="newOptionA" placeholder="ƒê√°p √°n A" /><br />
      <input id="newOptionB" placeholder="ƒê√°p √°n B" /><br />
      <input id="newOptionC" placeholder="ƒê√°p √°n C" /><br />
      <input id="newOptionD" placeholder="ƒê√°p √°n D" /><br />
      <input id="newCorrect" placeholder="ƒê√°p √°n ƒë√∫ng (A/B/C/D)" /><br />
      <button onclick="addQuestion()">Th√™m c√¢u h·ªèi</button>
      <hr>
      <h3>K·∫øt qu·∫£ ng∆∞·ªùi d√πng</h3>
      <div id="scoreList" class="score-list"></div>
      <button onclick="resetAllScores()">üîÑ Reset t·∫•t c·∫£ k·∫øt qu·∫£</button>
    </div>

  </div>

  <script>
    let questions = JSON.parse(localStorage.getItem("questions")) || [
      { text: "Th·ªß ƒë√¥ c·ªßa Vi·ªát Nam l√†?", options: ["H√† N·ªôi", "TP.HCM", "ƒê√† N·∫µng", "Hu·∫ø"], answer: "A" },
      { text: "1 + 1 = ?", options: ["1", "2", "3", "4"], answer: "B" }
    ];

    let scores = JSON.parse(localStorage.getItem("scores")) || {}; // l∆∞u ƒëi·ªÉm t·ª´ng ng∆∞·ªùi
    let currentUser = null;
    let submitted = false;

    function saveQuestions() {
      localStorage.setItem("questions", JSON.stringify(questions));
    }

    function saveScores() {
      localStorage.setItem("scores", JSON.stringify(scores));
    }

    function login() {
      const user = document.getElementById("username").value.trim();
      const pass = document.getElementById("password").value.trim();

      if (user === "admin" && pass === "1234") {
        currentUser = "admin";
        showAdminPanel();
      } else if (pass === "1234" && user.startsWith("guest")) {
        currentUser = user;
        if (scores[user] && scores[user].submitted) {
          alert("T√†i kho·∫£n n√†y ƒë√£ n·ªôp b√†i r·ªìi!");
          showResultAfterLogin();
        } else {
          showQuiz();
        }
      } else {
        alert("Sai t√†i kho·∫£n ho·∫∑c m·∫≠t kh·∫©u!");
      }
    }

    // ============================
    //        M√ÄN H√åNH ADMIN
    // ============================
    function showAdminPanel() {
      document.getElementById("loginScreen").classList.add("hidden");
      document.getElementById("adminPanel").classList.remove("hidden");
      loadAdminQuestions();
      loadScoreList();
    }

    function loadAdminQuestions() {
      const container = document.getElementById("adminQuestions");
      container.innerHTML = "";
      questions.forEach((q, i) => {
        const div = document.createElement("div");
        div.classList.add("question");
        div.innerHTML = `
          <textarea onchange="updateQuestion(${i}, this.value)">${q.text}</textarea><br>
          ${["A","B","C","D"].map((opt, idx) => `
            <input value="${q.options[idx]}" onchange="updateOption(${i}, ${idx}, this.value)" /> (${opt})
          `).join("<br>")}<br>
          ƒê√°p √°n ƒë√∫ng: <input value="${q.answer}" onchange="updateAnswer(${i}, this.value.toUpperCase())" /><br>
          <button onclick="deleteQuestion(${i})">X√≥a</button>
          <hr>
        `;
        container.appendChild(div);
      });
    }

    function loadScoreList() {
      const container = document.getElementById("scoreList");
      const users = Object.keys(scores);
      if (users.length === 0) {
        container.innerHTML = "<i>Ch∆∞a c√≥ ai l√†m b√†i</i>";
        return;
      }
      container.innerHTML = users.map(u => `
        <p><b>${u}</b>: ${scores[u].score}/${questions.length} (${scores[u].submitted ? "ƒê√£ n·ªôp" : "Ch∆∞a n·ªôp"})</p>
      `).join("");
    }

    function updateQuestion(i, val) {
      questions[i].text = val;
      saveQuestions();
    }

    function updateOption(i, idx, val) {
      questions[i].options[idx] = val;
      saveQuestions();
    }

    function updateAnswer(i, val) {
      questions[i].answer = val;
      saveQuestions();
    }

    function addQuestion() {
      const text = document.getElementById("newQuestionText").value;
      const opts = [
        document.getElementById("newOptionA").value,
        document.getElementById("newOptionB").value,
        document.getElementById("newOptionC").value,
        document.getElementById("newOptionD").value
      ];
      const ans = document.getElementById("newCorrect").value.toUpperCase();
      if (!text || !opts.every(o => o) || !"ABCD".includes(ans)) {
        alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!");
        return;
      }
      questions.push({ text, options: opts, answer: ans });
      saveQuestions();
      loadAdminQuestions();
      alert("ƒê√£ th√™m c√¢u h·ªèi!");
    }

    function deleteQuestion(i) {
      if (confirm("X√≥a c√¢u h·ªèi n√†y?")) {
        questions.splice(i, 1);
        saveQuestions();
        loadAdminQuestions();
      }
    }

    function resetAllScores() {
      if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën reset t·∫•t c·∫£ k·∫øt qu·∫£ kh√¥ng?")) {
        scores = {};
        saveScores();
        loadScoreList();
        alert("ƒê√£ reset t·∫•t c·∫£ k·∫øt qu·∫£!");
      }
    }

    // ============================
    //        M√ÄN H√åNH KH√ÅCH
    // ============================
    function showQuiz() {
      document.getElementById("loginScreen").classList.add("hidden");
      document.getElementById("quizScreen").classList.remove("hidden");
      const container = document.getElementById("questionList");
      container.innerHTML = "";
      questions.forEach((q, i) => {
        const div = document.createElement("div");
        div.classList.add("question");
        div.innerHTML = `
          <p><b>C√¢u ${i + 1}:</b> ${q.text}</p>
          ${["A","B","C","D"].map((opt, idx) => `
            <label><input type="radio" name="q${i}" value="${opt}"> ${opt}. ${q.options[idx]}</label><br>
          `).join("")}
        `;
        container.appendChild(div);
      });
    }

    function submitQuiz() {
      if (submitted) return;
      let correct = 0;
      questions.forEach((q, i) => {
        const ans = document.querySelector(`input[name="q${i}"]:checked`);
        if (ans && ans.value === q.answer) correct++;
      });

      document.getElementById("result").innerText = `B·∫°n tr·∫£ l·ªùi ƒë√∫ng ${correct}/${questions.length} c√¢u.`;
      submitted = true;
      document.getElementById("submitBtn").disabled = true;

      scores[currentUser] = { score: correct, submitted: true };
      saveScores();
    }

    function showResultAfterLogin() {
      document.getElementById("loginScreen").classList.add("hidden");
      document.getElementById("quizScreen").classList.remove("hidden");
      document.getElementById("questionList").innerHTML = "<p>B·∫°n ƒë√£ l√†m b√†i r·ªìi.</p>";
      document.getElementById("submitBtn").style.display = "none";
      document.getElementById("result").innerText = `K·∫øt qu·∫£ tr∆∞·ªõc ƒë√¢y: ${scores[currentUser].score}/${questions.length}`;
    }
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quiz App</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 700px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h1, h2 {
      text-align: center;
    }
    input, button, textarea {
      font-family: Arial, sans-serif;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px 0;
    }
    button:hover {
      background: #0056b3;
    }
    .hidden {
      display: none;
    }
    .question {
      margin-bottom: 15px;
    }
    .result {
      font-weight: bold;
      text-align: center;
      margin-top: 20px;
      color: green;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Hệ thống trắc nghiệm</h1>

    <!-- Màn hình đăng nhập -->
    <div id="loginScreen">
      <h2>Đăng nhập</h2>
      <input type="text" id="username" placeholder="Tên đăng nhập" /><br />
      <input type="password" id="password" placeholder="Mật khẩu" /><br />
      <button onclick="login()">Đăng nhập</button>
      <p><small>Tài khoản admin: <b>admin / 1234</b></small></p>
      <p><small>Tài khoản khách: <b>guest / 1234</b></small></p>
    </div>

    <!-- Màn hình câu hỏi -->
    <div id="quizScreen" class="hidden">
      <h2>Bài trắc nghiệm</h2>
      <div id="questionList"></div>
      <button id="submitBtn" onclick="submitQuiz()">Nộp bài</button>
      <div class="result" id="result"></div>
    </div>

    <!-- Màn hình chỉnh sửa câu hỏi (Admin) -->
    <div id="adminPanel" class="hidden">
      <h2>Quản lý câu hỏi</h2>
      <div id="adminQuestions"></div>
      <h3>Thêm câu hỏi mới</h3>
      <textarea id="newQuestionText" placeholder="Nhập câu hỏi..."></textarea><br />
      <input id="newOptionA" placeholder="Đáp án A" /><br />
      <input id="newOptionB" placeholder="Đáp án B" /><br />
      <input id="newOptionC" placeholder="Đáp án C" /><br />
      <input id="newOptionD" placeholder="Đáp án D" /><br />
      <input id="newCorrect" placeholder="Đáp án đúng (A/B/C/D)" /><br />
      <button onclick="addQuestion()">Thêm câu hỏi</button>
    </div>

  </div>

  <script>
    // Dữ liệu câu hỏi mẫu
    let questions = JSON.parse(localStorage.getItem("questions")) || [
      { text: "Thủ đô của Việt Nam là?", options: ["Hà Nội", "TP.HCM", "Đà Nẵng", "Huế"], answer: "A" },
      { text: "1 + 1 = ?", options: ["1", "2", "3", "4"], answer: "B" }
    ];

    let currentUser = null;
    let submitted = false;

    function login() {
      const user = document.getElementById("username").value.trim();
      const pass = document.getElementById("password").value.trim();

      if (user === "admin" && pass === "1234") {
        currentUser = "admin";
        showAdminPanel();
      } else if (user === "guest" && pass === "1234") {
        currentUser = "guest";
        showQuiz();
      } else {
        alert("Sai tài khoản hoặc mật khẩu!");
      }
    }

    // Hiển thị cho khách
    function showQuiz() {
      document.getElementById("loginScreen").classList.add("hidden");
      document.getElementById("quizScreen").classList.remove("hidden");

      const container = document.getElementById("questionList");
      container.innerHTML = "";
      questions.forEach((q, i) => {
        const div = document.createElement("div");
        div.classList.add("question");
        div.innerHTML = `
          <p><b>Câu ${i + 1}:</b> ${q.text}</p>
          ${["A","B","C","D"].map((opt, idx) => `
            <label>
              <input type="radio" name="q${i}" value="${opt}"> ${opt}. ${q.options[idx]}
            </label><br>
          `).join("")}
        `;
        container.appendChild(div);
      });
    }

    // Chấm điểm và hiển thị kết quả
    function submitQuiz() {
      if (submitted) {
        alert("Bạn đã nộp bài rồi!");
        return;
      }

      let correct = 0;
      questions.forEach((q, i) => {
        const answer = document.querySelector(`input[name="q${i}"]:checked`);
        if (answer && answer.value === q.answer) correct++;
      });

      document.getElementById("result").innerText = `Bạn trả lời đúng ${correct}/${questions.length} câu.`;
      submitted = true;
      document.getElementById("submitBtn").disabled = true;
    }

    // Hiển thị cho admin
    function showAdminPanel() {
      document.getElementById("loginScreen").classList.add("hidden");
      document.getElementById("adminPanel").classList.remove("hidden");
      loadAdminQuestions();
    }

    function loadAdminQuestions() {
      const container = document.getElementById("adminQuestions");
      container.innerHTML = "";
      questions.forEach((q, i) => {
        const div = document.createElement("div");
        div.classList.add("question");
        div.innerHTML = `
          <textarea onchange="updateQuestion(${i}, this.value)">${q.text}</textarea><br>
          ${["A","B","C","D"].map((opt, idx) => `
            <input value="${q.options[idx]}" onchange="updateOption(${i}, ${idx}, this.value)" /> (${opt})
          `).join("<br>")}<br>
          Đáp án đúng: <input value="${q.answer}" onchange="updateAnswer(${i}, this.value.toUpperCase())" /><br>
          <button onclick="deleteQuestion(${i})">Xóa</button>
          <hr>
        `;
        container.appendChild(div);
      });
    }

    function updateQuestion(i, val) {
      questions[i].text = val;
      saveQuestions();
    }

    function updateOption(i, optIndex, val) {
      questions[i].options[optIndex] = val;
      saveQuestions();
    }

    function updateAnswer(i, val) {
      questions[i].answer = val;
      saveQuestions();
    }

    function addQuestion() {
      const text = document.getElementById("newQuestionText").value;
      const opts = [
        document.getElementById("newOptionA").value,
        document.getElementById("newOptionB").value,
        document.getElementById("newOptionC").value,
        document.getElementById("newOptionD").value
      ];
      const ans = document.getElementById("newCorrect").value.toUpperCase();

      if (!text || !opts.every(o => o) || !"ABCD".includes(ans)) {
        alert("Vui lòng nhập đầy đủ thông tin và đáp án hợp lệ!");
        return;
      }

      questions.push({ text, options: opts, answer: ans });
      saveQuestions();
      loadAdminQuestions();
      alert("Đã thêm câu hỏi mới!");
    }

    function deleteQuestion(i) {
      if (confirm("Xóa câu hỏi này?")) {
        questions.splice(i, 1);
        saveQuestions();
        loadAdminQuestions();
      }
    }

    function saveQuestions() {
      localStorage.setItem("questions", JSON.stringify(questions));
    }
  </script>
</body>
</html>
